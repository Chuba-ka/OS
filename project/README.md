```markdown
# Простая клиент-серверная система мгновенных сообщений (C++) — pthread версия

Изменения и поведение при завершении
- Добавлено поле server_stopping в общую память (SharedData).
- Когда сервер завершает работу (через Ctrl+C / SIGINT или команду exit/quit в CLI), он:
  - Устанавливает data->server_stopping = 1 под защитой mutex.
  - Делает pthread_cond_broadcast(&data->cond), чтобы разбудить монитор и клиентов.
  - Ждёт завершения фонового monitor-потока (pthread_join).
- Клиенты при пробуждении или проверке состояния видят, что data->server_stopping == 1, и корректно завершают работу (печатают уведомление и выходят).
- Таким образом клиенты автоматически завершаются при остановке сервера.

Краткое описание системы
- Клиент может присоединиться к серверу, введя логин.
- Клиент может отправить сообщение другому клиенту по его логину.
- Клиент в реальном времени принимает сообщения от других клиентов.
- Сервер хранит историю переписок в файле `history.txt` и позволяет искать по ней.
- Связь реализована через memory map (POSIX shared memory + pthread mutex/cond).

Ограничения
- Платформа: POSIX (Linux/Mac).
- Максимум 16 клиентов, 1024 сообщений, длина текста 256 символов.
- Сервер должен быть запущен первым.

Сборка (CMake)
- Требуется CMake (версия >= 3.5) и компилятор с поддержкой C++11.
- Рекомендуемый способ сборки в отдельной директории:

  mkdir -p build
  cd build
  cmake ..
  cmake --build .

- После успешной сборки в папке build появятся бинарники `server` и `client`.
- Для очистки просто удалите каталог build:
  rm -rf build

Запуск
1. Запустите сервер:
   ./server
   В сервере доступны команды:
   - list_clients
   - search <user1> <user2> [keyword]
   - help
   - exit

2. Запустите клиент в другом терминале:
   ./client
   Введите логин, затем используйте команды:
   - send <recipient> <message>
   - help
   - exit

Поведение при остановке сервера
- Нажмите Ctrl+C в терминале сервера или введите exit/quit в CLI сервера.
- Сервер выставит флаг shutdown в общей памяти и разбудит всех клиентов.
- Клиенты при обнаружении данного флага распечатают сообщение и завершат работу.
- Если вы хотите, чтобы shared memory удалялась автоматически при остановке сервера, можно добавить shm_unlink в server (опция не включена по умолчанию в этой версии).

```